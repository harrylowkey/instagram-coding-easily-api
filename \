import { Body, Controller, HttpCode, Post, Res, UseInterceptors } from '@nestjs/common';
import { Response } from 'express';

import { ApiTags } from '@nestjs/swagger';
import { DiscordService } from '~discord/services/discord.service';
import { DiscordInteractionType } from '~discord/types/discord-interaction.type';
import { CamelCaseRequestBodyInterceptor } from '~core/interceptors/camel-case-request-body.interceptor';

@Controller('discords')
@ApiTags('Discords')
export class DiscordController {
    constructor(private discordService: DiscordService) { }

    @Post('interactions')
    @UseInterceptors(CamelCaseRequestBodyInterceptor)
    @HttpCode(200)
    handleDiscordBotInteraction(@Body() dto: DiscordInteractionType, @Res() res: Response): Response {
        console.log({ dto });
        return this.discordService.handleDiscordBotInteraction(dto, res);
    }
}
